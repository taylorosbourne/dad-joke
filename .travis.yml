language: node_js
node_js:
- '11'
cache: npm
install: npm install
script:
- ".\\bin\\run --version"
- ".\\bin\\run --help"
- npm run test
include:
  - stage: Build and test
    script: 
      - npm lint
      - npm test
      - npm build
  - stage: npm release
    script: npm build
    deploy:
      provider: npm
      email: '$NPM_EMAIL'
      api_key: '$NPM_TOKEN'
      skip_cleanup: true
      on: 
        tags: true
      repo: taylorosbourne/dad-joke

branches:
  only:
    - master
    - /^V[0-9]+.*$/
